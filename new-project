#!/bin/bash
# New Project Setup Script
# Creates project directory with TaskMaster and git initialized

set -e

PROJECT_NAME="$1"

if [ -z "$PROJECT_NAME" ]; then
    read -p "Project name: " PROJECT_NAME
fi

if [ -z "$PROJECT_NAME" ]; then
    echo "Error: Project name required"
    exit 1
fi

PROJECT_DIR="$HOME/$PROJECT_NAME"

if [ -d "$PROJECT_DIR" ]; then
    echo "Directory $PROJECT_DIR already exists"
    exit 1
fi

echo "Creating project: $PROJECT_NAME"
echo ""

# Create project directory
mkdir -p "$PROJECT_DIR"
cd "$PROJECT_DIR"

# Initialize git
git init

# Create .taskmaster structure
mkdir -p .taskmaster/docs .taskmaster/tasks

# Create default TaskMaster config
cat > .taskmaster/config.json << 'EOF'
{
  "models": {
    "main": {
      "provider": "anthropic",
      "modelId": "claude-sonnet-4-20250514",
      "maxTokens": 64000,
      "temperature": 0.2
    },
    "research": {
      "provider": "anthropic",
      "modelId": "claude-sonnet-4-20250514",
      "maxTokens": 64000,
      "temperature": 0.1
    },
    "fallback": {
      "provider": "anthropic",
      "modelId": "claude-sonnet-4-20250514",
      "maxTokens": 64000,
      "temperature": 0.2
    }
  },
  "global": {
    "logLevel": "info",
    "debug": false,
    "defaultSubtasks": 5,
    "defaultPriority": "medium"
  }
}
EOF

# Create empty tasks.json
cat > .taskmaster/tasks/tasks.json << 'EOF'
{
  "tasks": [],
  "metadata": {
    "version": "1.0.0",
    "tags": ["master"]
  }
}
EOF

# Create PRD template
cat > .taskmaster/docs/prd.txt << EOF
# $PROJECT_NAME

## Overview
[Project description here]

## Requirements

### 1. Core Features
- Feature 1
- Feature 2

### 2. Nice to Have
- Optional feature

## Technical Notes
[Any technical considerations]
EOF

# Create CLAUDE.md
cat > CLAUDE.md << EOF
# $PROJECT_NAME

## Project Overview
[Describe what this project does]

## Tech Stack
- [List technologies used]

## Getting Started
\`\`\`bash
# Installation steps
\`\`\`

## TaskMaster
PRD: \`.taskmaster/docs/prd.txt\`
Tasks: \`.taskmaster/tasks/tasks.json\`
EOF

# Create .gitignore
cat > .gitignore << 'EOF'
node_modules/
.env
*.log
.DS_Store
EOF

echo "Created:"
echo "  $PROJECT_DIR/"
echo "  ├── .taskmaster/"
echo "  │   ├── config.json"
echo "  │   ├── docs/prd.txt"
echo "  │   └── tasks/tasks.json"
echo "  ├── CLAUDE.md"
echo "  └── .gitignore"
echo ""
echo "Next steps:"
echo "  1. Edit .taskmaster/docs/prd.txt with your requirements"
echo "  2. Run: make claude $PROJECT_NAME"
echo "  3. Ask Claude to parse PRD and create tasks"
